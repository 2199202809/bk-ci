# IDC代理转发
location = /proxy-idc {
    set_by_lua_block $url {
        return ngx.unescape_uri(ngx.var.arg_url)
    }
    proxy_pass $url;
}

# DEVNET代理转发
location = /proxy-devnet {
    set_by_lua_block $url {
        return ngx.unescape_uri(ngx.var.arg_url)
    }
    proxy_pass $url;
}

# OSS代理转发
location = /proxy-oss {
    set_by_lua_block $url {
        return ngx.unescape_uri(ngx.var.arg_url)
    }
    proxy_pass $url;
}

# dispatch 相关静态文件下载
location ~ /(ms/|)dispatch/gw/build/(scripts/|)(.*) {
    include gray.conf;
    set_by_lua_block $target {
        return config.bkrepo.domain
    }

    proxy_connect_timeout 60;
    proxy_read_timeout 1200;
    proxy_send_timeout 1200;

    proxy_pass http://$target/generic/bkdevops/static/gw/dispatch/$grayDir/$3;

    proxy_intercept_errors on;
    error_page 404 410 429 502 503 =200 /internal/file/dispatch/$grayDir/$3;
}

